# Makefile.in -- Makefile for libmaa
# Created: Sun Nov 19 13:32:41 1995 by faith@cs.unc.edu
# Revised: Fri Jan 12 14:44:08 1996 by r.faith@ieee.org
# Copyright 1995 Rickard E. Faith (faith@cs.unc.edu)
# 
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the
# Free Software Foundation; either version 1, or (at your option) any
# later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, write to the Free Software Foundation, Inc.,
# 675 Mass Ave, Cambridge, MA 02139, USA.
# 
# $Id: Makefile.in,v 1.12 1996/01/15 03:47:59 faith Exp $
#

MAA_MAJOR=0
MAA_MINOR=9

.SUFFIXES:
.SUFFIXES: .c .o

ifneq (,)
This makefile requires GNU Make.
endif

srcdir=		@srcdir@
VPATH=		@srcdir@
prefix=		@prefix@
exec_prefix=	@exec_prefix@

SHELL=		/bin/sh

CC=		@CC@
CFLAGS=		@CFLAGS@
VFLAGS=         -DMAA_MAJOR=$(MAA_MAJOR) -DMAA_MINOR=$(MAA_MINOR)
XCFLAGS=	@EXTRACFLAGS@ @DEFS@ $(VFLAGS) @DMCFLAGS@ -I. -I..
LDFLAGS=	@LDFLAGS@
XLDFLAGS=	-L.
CPP=		@CPP@

LDLIBS=		-lmaa @LIBS@ @DMLIBS@ -lm

LEX=		@LEX@
LEXLIB= 	@LEXLIB@
YACC=		@YACC@

LN_S=		@LN_S@
RANLIB=		@RANLIB@
INSTALL_PROGRAM=@INSTALL_PROGRAM@
INSTALL_DATA=	@INSTALL_DATA@

HEADERS= config.h maa.h maaP.h decl.h obstack.h
LIBOBJS= @LIBOBJS@ obstack.o getopt.o getopt1.o \
	 hash.o set.o stack.o list.o error.o memory.o string.o \
	 debug.o maa.o prime.o bit.o timer.o version.o arg.o pr.o
TESTS=	 settest hashtest stringtest debugtest \
	 primetest listtest bittest argtest
EXES=    memtest prtest

LIBS=    libmaa.a

lib: $(LIBS)

all: $(LIBS) $(EXES) $(TESTS)

tests: $(TESTS)
	@for i in $(TESTS); do \
		./$$i | fgrep -v ' at ' > ./$$i.out.new; \
		if cmp ./$$i.out $$i.out.new; \
			then echo PASSED $$i; rm -f $$i.out.new; \
			else echo FAILED $$i; \
		fi; \
	done

tests-update: $(TESTS)
	@for i in $(TESTS); do \
		echo Writing $$i.out; \
		./$$i | fgrep -v ' at ' > $$i.out; \
	done

%.o: %.c
	$(CC) -c $(CPPFLAGS) $(CFLAGS) $(XCFLAGS) $<

%: %.o
	$(CC) $(LDFLAGS) $(XLDFLAGS) -o $@ $< $(LDLIBS)

$(EXES) $(TESTS): $(LIBS)

ALLFLAGS=$(CPPFLAGS) $(CFLAGS) $(XCFLAGS) $(LDFLAGS) $(XLDFLAGS)
%: %.c
	$(CC) $(ALLFLAGS) -o $@ $< $(LDLIBS)

date := $(shell date)
version.stamp: version.c
	cp version.c version.tmp
	sed "s,/\* Stamp: .*\*/,/* Stamp: $(date) */," \
		< version.tmp > version.c
	touch version.stamp

version.c:
	echo "/* Stamp: `date` */" > version.c
	echo 'const char *maa_revision_string = "$$Revision: 1.12 $$";' >> version.c

libmaa.a:: $(LIBOBJS)
	$(AR) $(ARFLAGS) $@ $(LIBOBJS)
	$(RANLIB) $@

$(LIBOBJS): $(HEADERS)
$(EXES):    $(HEADERS) $(LIBS)

.PHONY: clean cleandist tags
clean:
	-rm -f *.o *.s *~ core a.out config.log $(TESTS) $(EXES)
	-rm -f *.log *.aux *.toc *.dvi *.ps *.out.new
	-rm -f *.cfg *.dtk .inslog tca.map .pure
	-rm -f version.stamp version.tmp

distclean: clean
	-rm -f config.h config.cache Makefile $(LIBS)

tags:
	etags: *.c

# The following is based on the "Automatic Remaking" node in the GNU
# Autoconf documentation:

$(srcdir)/configure: configure.in
	cd $(srcdir) && autoconf

# autoheader might not change config.h.in, so touch a stamp file.
${srcdir}/config.h.in: stamp-h.in
${srcdir}/stamp-h.in: configure.in
	cd ${srcdir} && autoheader
	date > ${srcdir}/stamp-h.in
     
config.h: stamp-h
stamp-h: config.h.in config.status
	./config.status
     
Makefile: Makefile.in config.status
	./config.status
     
config.status: configure
	./config.status --recheck

